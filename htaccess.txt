##
# @package    MiMFa aseqbase
# @copyright  Copyright (C) 2005 - 2023 Open Source Matters
# @license    GNU General Public License version 3 or later ; see LICENSE.txt
##

# Default charset
AddDefaultCharset UTF-8
# Do NOT force charset on .js files
AddCharset utf-8 .html .css .xml .json .rss

# Correct MIME types for fonts
AddType font/woff .woff
AddType font/woff2 .woff2
AddType application/vnd.ms-fontobject .eot
AddType font/ttf .ttf
AddType font/otf .otf
AddType image/svg+xml .svg

##
# Remove ETag
Header unset ETag
FileETag none

<IfModule mod_expires.c>
  ExpiresActive on
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/png  "access plus 1 year"
  ExpiresByType image/gif  "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType video/webm "access plus 1 year"
  ExpiresByType application/javascript "access plus 1 year"
  ExpiresByType text/css "access plus 1 year"
  ExpiresByType font/woff "access plus 1 year"
  ExpiresByType font/woff2 "access plus 1 year"
  ExpiresByType font/ttf "access plus 1 year"
  ExpiresByType font/otf "access plus 1 year"
  ExpiresByType application/pdf "access plus 1 month"
  ExpiresDefault "access plus 7 days"
</IfModule>
<IfModule mod_rewrite.c>
  RewriteCond %{REQUEST_METHOD} OPTIONS
  RewriteRule ^(.*)$ $1 [R=200,L]
</IfModule>
<IfModule mod_headers.c>
  <FilesMatch "\.(js|css|ico|pdf|gif|jpg|jpeg|png|webp|svg|woff|woff2|ttf|otf)$">
    Header append Cache-Control "public"
  </FilesMatch>
  <FilesMatch "\.(txt|html)$">
    Header append Cache-Control "proxy-revalidate"
  </FilesMatch>
  <FilesMatch "\.(php|cgi|pl|htm|xml)$">
    Header set Cache-Control "private, no-cache, no-store, proxy-revalidate, no-transform"
    Header set Pragma "no-cache"
  </FilesMatch>
  # Allow AJAX / XHR
  Header always set Access-Control-Allow-Origin "*"
  Header always set Access-Control-Allow-Headers "X-Custom-Method, Content-Type, X-Requested-With"
  Header always set Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE, OPTIONS"
</IfModule>

<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE image/svg+xml
  AddOutputFilterByType DEFLATE image/x-icon
  BrowserMatch ^Mozilla/4 gzip-only-text/html
  BrowserMatch ^Mozilla/4\.0[678] no-gzip
  BrowserMatch \bMSI[E] !no-gzip !gzip-only-text/html
  Header append Vary User-Agent
</IfModule>

# Block referer spammers
RewriteCond %{HTTP_REFERER} ^.*(ranksonic\.|semalt\.|kambasoft\.|buttons-for-website\.|buttons-for-your-website\.com|4webmasters\.org|social-buttons\.com|best-seo-offer\.com|best-seo-solution\.com).*$ [NC]
RewriteRule ^(.*)$ - [F]

# Protect sensitive files
<files wp-config.php>
  order allow,deny
  deny from all
</files>
<files "xmlrpc.php">
  order allow,deny
  deny from all
</files>
<files .htaccess>
  order allow,deny
  deny from all
</files>

RewriteEngine on
RewriteCond %{HTTP_USER_AGENT} ^msnbot
RewriteRule ^.* - [F,L]

# Default index pages
DirectoryIndex index.php index.htm index.html static.php
Options +FollowSymlinks
Options -Indexes

# Block common exploits
RewriteCond %{QUERY_STRING} base64_encode[^(]*\([^)]*\) [OR]
RewriteCond %{QUERY_STRING} (<|%3C)([^s]*s)+cript.*(>|%3E) [NC,OR]
RewriteCond %{QUERY_STRING} GLOBALS( = |\[|\%[0-9A-Z]{0,2}) [OR]
RewriteCond %{QUERY_STRING} _REQUEST( = |\[|\%[0-9A-Z]{0,2})
RewriteRule .* /index.php [F]

# MiMFa! core SEF Section
RewriteCond %{REQUEST_URI} !^/index\.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ /index.php [L]